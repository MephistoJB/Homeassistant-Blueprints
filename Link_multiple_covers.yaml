blueprint:
  name: Link Multiple Covers
  description: Link multiple covers together v1.0.0 based on aderushas link_multiple_switches
  domain: automation
  homeassistant:
    min_version: 2022.5.0
  input:
    covers:
      name: Covers Entites
      selector:
        entity:
          domain: cover
          multiple: true
  source_url: https://github.com/MephistoJB/Homeassistant-Blueprints/blob/main/Link_multiple_covers_together.yaml

mode: queued
max_exceeded: silent

variables:
  covers: !input 'cover'
  
trigger:
  - platform: state
    entity_id: !input 'cover'

condition:
  - condition: template
    value_template: "{{ trigger.to_state.state != trigger.from_state.state }}"
  - condition: template
    value_template: "{{ trigger.to_state.context.parent_id is none
      or  (trigger.to_state.context.id != this.context.id
      and  trigger.to_state.context.parent_id  != this.context.id) }}"
      
action:
  - service: cover.{{ trigger.to_state.state | replace("ing", "")}}_cover
    target:
      entity_id: '{{ expand(covers) | selectattr("entity_id", "!=", trigger.entity_id)
        | map(attribute="entity_id") | list }}'
